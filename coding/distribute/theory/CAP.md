# CAP理论

- Consistency(一致性): 访问所有的节点得到的数据都相同；
- Availability(可用性): 非故障的节点在合理的时间内返回合理的响应；
- Partition Tolerance(分区容错性)：分布式系统出现网络分区时，仍能够对外提供服务。

## 网络分区

分布式系统中，多个节点之前的网络本来是连通的，但是因为某些故障(比如网络原因)，某些节点之间不来连通了，整个网络就分为几块区域，这就是网络分区。

## C & A互斥

CAP理论中P分区容错性是必须要满足的，强一致性和可用性只能2选1。

* ZooKeeper就是CP结构
* Euraka是AP架构
* Nacos官方推荐是AP的。

## 脑裂

集群(M-S模式)通常发生在节点通信不可达(分区)的情况下，集群会分裂成不同的小集群各自选举出多个master节点的情况。

**避免方式：**
leader选举时要求节点投票的数量>总结点数/2，即过半数，这样的选举方式保证了集群出现分区时，无论如何最多只能由一个小集选出leader。

同时，这里还有一个小tips，就是集群的节点个数推荐是奇数个：
* 偶数个的节点一旦出现对半分区，会导致集群无法选举出master，
* 同时在容错能力相同的情况下，奇数节点比偶数节约资源，比如，5个节点挂了2个还能选出leader，而6个节点最多也只能挂2个节点才能保证选举出leader。






